<!doctype html>
<html lang="en">

<head>
  <title>Smart EVSE</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <style>
    body {
      text-shadow: 0 .05rem .1rem rgba(0, 0, 0, .5);
      box-shadow: inset 0 0 5rem rgba(0, 0, 0, .5);
      --bs-heading-color: rgba(255, 255, 255, 0.9);
    }

    .bg-body-tertiary {
      background-color: #27293D !important;
    }

    .shadow {
      box-shadow: 0 1px 20px 0 rgba(0, 0, 0, .1);
    }

    .btn-bd-primary {
      --bs-btn-font-weight: 600;
      --bs-btn-color: var(--bs-white);
      --bs-btn-bg: #712cf9;
      --bs-btn-border-color: #712cf9;
      --bs-btn-hover-color: var(--bs-white);
      --bs-btn-hover-bg: #6528e0;
      --bs-btn-hover-border-color: #6528e0;
      --bs-btn-focus-shadow-rgb: 112.520718, 44.062154, 249.437846;
      --bs-btn-active-color: var(--bs-white);
      --bs-btn-active-bg: #5a23c8;
      --bs-btn-active-border-color: #5a23c8;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      color: lightseagreen;
    }

    #version {
      font-size: medium;
    }

    svg {
      fill: cornflowerblue;
    }

    #evse_data .col .row>* {
      min-width: 130px !important;
    }

    #solar_boost_check_label {
      margin: 5px 0 0 0;
    }

    #solar_boost_check {
      border: solid 2px #777;
      width: 75px;
      height: 1.8em;
      margin: 0 5px -15px 0;
    }

    #solar_boost_check:checked {
      border: solid 2px #888;
      background-color: #712cf9;
    }

    .row .form-switch {
      padding-left: 0;
    }

    i.bi {
      color: gray;
      vertical-align: top;
    }

    .form-range::-moz-range-track {
      height: 1rem;
      background-color: #6c757d;
      border: solid 2px #47495a;
    }

    .form-range::-moz-range-thumb {
      width: 3rem;
      height: 2rem;
      background-color: #6528e0;
      border: solid 2px #6c757d !important;
    }

    @media screen and (max-width: 420px) {

      .h5,
      h5 {
        font-size: 1.10rem;
      }

      #evse_data .col .row>* {
        min-width: 85px !important;
      }
    }
  </style>
  <style>
    .header {
      position: relative;
      text-align: center;
      background: linear-gradient(60deg, rgb(131, 12, 198) 0%, rgb(0, 172, 193) 100%);
      /*background: linear-gradient(60deg, rgba(84, 58, 183, 1) 0%, rgba(0, 172, 193, 1) 100%);*/
      /*background: linear-gradient(60deg, rgb(67, 177, 100) 0%, rgb(3, 13, 70) 100%);*/
    }

    .inner-header {
      width: 100%;
      margin: 15px 0 0 0;
      padding: 0;
      position: absolute;
      z-index: 1;
    }

    .inner-header h3 {
      color: #fff;
      text-shadow: 1px 1px 1px rgb(0, 0, 0);
    }

    .waves {
      position: relative;
      width: 100%;
      height: 80px;
      margin-bottom: -7px;
      /*Fix for safari gap*/
      min-height: 80px;
      max-height: 150px;
      z-index: 0;
    }

    .content {
      position: relative;
      height: 20vh;
      text-align: center;
      background-color: white;
    }

    /* Animation */

    .parallax>use {
      animation: move-forever 15s cubic-bezier(.55, .5, .45, .5) infinite;
    }

    .parallax>use:nth-child(1) {
      animation-delay: -2s;
      animation-duration: 5s;
    }

    .parallax>use:nth-child(2) {
      animation-delay: -3s;
      animation-duration: 8s;
    }

    .parallax>use:nth-child(3) {
      animation-delay: -4s;
      animation-duration: 11s;
    }

    .parallax>use:nth-child(4) {
      animation-delay: -5s;
      animation-duration: 18s;
    }

    @keyframes move-forever {
      0% {
        transform: translate3d(-90px, 0, 0);
      }

      100% {
        transform: translate3d(85px, 0, 0);
      }
    }

    /*Shrinking for mobile*/
    @media (max-width: 768px) {
      .waves {
        height: 60px;
        min-height: 60px;
      }

      .content {
        height: 30vh;
      }

      h1 {
        font-size: 24px;
      }
    }
  </style>
  <script>
    let endpoint = "/settings";
    let initiated = false;
    let lastReceivedCTSeconds = null;
    let intervalHandler = null;
    let prevSolarBoost = null;

    function updateLastReceivedCT() {
      if (lastReceivedCTSeconds != null) {
        $('#p1_data_received').text(lastReceivedCTSeconds == -1 ? "--" : relativeTime(Math.round(lastReceivedCTSeconds / 1000)));
      }
    }

    function relativeTime(seconds) {
      let output = "";
      if (seconds < 60) {
        // Less than a minute has passed:
        output = `${seconds} seconds ago`;
      } else if (seconds < 3600) {
        // Less than an hour has passed:
        output = `${Math.floor(seconds / 60)} minutes ago`;
      } else if (seconds < 86400) {
        // Less than a day has passed:
        output = `${Math.floor(seconds / 3600)} hours ago`;
      } else if (seconds < 2620800) {
        // Less than a month has passed:
        output = `${Math.floor(seconds / 86400)} days ago`;
      } else if (seconds < 31449600) {
        // Less than a year has passed:
        output = `${Math.floor(seconds / 2620800)} months ago`;
      } else {
        // More than a year has passed:
        output = `${Math.floor(seconds / 31449600)} years ago`;
      }
      return output;
    }

    function formatTime(timeInt) {
      if (timeInt < 0) {
        return "--:--";
      }

      let strTime = timeInt.toString().padStart(4, "0");
      return strTime.slice(0, 2) + ":" + strTime.slice(2);
    }


    function loadData() {
      $.ajax({
        url: endpoint
      }).then(function (data) {
        try {
          if (!initiated) {
            initiated = true;
            $('#hostname').text(data.hostname);
            $('#version').append(data.version);
            document.title = data.hostname;
          }

          if (data.controller.error) {
            $('#error').text(data.controller.errorText);
            $('[id=with_errors]').show();
          } else {
            $('[id=with_errors]').hide();
          }
          $('#vehicle_connected').html(data.controller.vehicleConnected ? "<i class=\"bi bi-plug text-warning\"></i><span class=\"text-warning\">Vehicle connected</span>" : "<i class=\"bi bi-ev-station\"></i> Vehicle not detected");
          if (data.controller.isCharging) {
            $('#state').html("<i class=\"bi-battery-charging\"></i> ");
          }
          else {
            $('#state').html("");
          }
          $('#state').append(data.controller.stateText);

          if (data.controller.chargeDelaySeconds > 0) {
            $('#chargedelayseconds').text(data.controller.chargeDelaySeconds + " seconds");
            $('#chargedelayseconds_box').show();
          }
          else {
            $('#chargedelayseconds_box').hide();
          }
          if (data.controller.solarStopTimer > 0) {
            $('#solarstoptimer').text(data.controller.solarStopTimer + " seconds");
            $('#solarstoptimer_box').show();
          }
          else {
            $('#solarstoptimer_box').hide();
          }

          $('#solarstoptimeminutes').text(data.controller.solarStopTimeMinutes + " min");
          $('#solarstartcurrent').text(data.controller.solarStartCurrent + "A");
          $('#solarimportcurrent').text(data.controller.solarImportCurrent + "A");

          for (let x = 0; x < 4; x++) {
            if (x == data.nerd.logLevel) {
              $('#loglevel_' + x).removeClass("btn-outline-secondary");
              $('#loglevel_' + x).addClass("btn-bd-primary");
            } else {
              $('#loglevel_' + x).removeClass("btn-bd-primary");
              $('#loglevel_' + x).addClass("btn-outline-secondary");
            }
          }

          for (let x = 0; x < 3; x++) {
            if (x == data.controller.mode) {
              $('#mode_' + x).removeClass("btn-outline-secondary");
              $('#mode_' + x).addClass("btn-bd-primary");
            } else {
              $('#mode_' + x).removeClass("btn-bd-primary");
              $('#mode_' + x).addClass("btn-outline-secondary");
            }
          }

          $('#mode').text(data.controller.modeText);
          $('#config').html(data.controller.config == 0 ? "<i class=\"bi bi-outlet\"></i> Socket" : "<i class=\"bi bi-ev-station\"></i> Fixed cable");
          $('#charge_current').text((data.controller.chargeCurrent / 10).toFixed(1) + "A");
          if (data.controller.solarBoost) {
            $('#solar_boost_current').text((data.controller.solarBoostCurrent / 10).toFixed(1) + "A");
          }
          $("#solar_boost_check").prop("checked", data.controller.solarBoost ? true : false);
          if (prevSolarBoost != data.controller.solarBoost) {
            solarBoostChanged();
          }
          $('#temp').text(data.controller.temperature + "°C / " + data.controller.maxTemperature + "°C");
          $('#rfid').text((data.rfid.reader == 0) ? "Not installed" : "Enabled [" + data.rfid.statusText + "]");
          $('#rfid_access').text((data.rfid.accessBit == 0) ? "No access" : "Granted");
          if (data.rfid.reader == 0) {
            $('#rfid_access_box').hide();
          }
          else {
            $('#rfid_access_box').show();
          }

          $('#current_min').text(data.controller.minEVCurrent.toFixed(0) + "A");
          $('#current_max').text(data.controller.maxMains.toFixed(0) + "A");
          $('#device_max').text(data.controller.maxDeviceCurrent.toFixed(0) + "A");
          if (data.modbus.overrideCurrent > 0) {
            $('#override_current').text((data.modbus.overrideCurrent / 10).toFixed(1) + "A");
          }
          else {
            $('#override_current').text("--");
          }

          $('#cable_max').text(data.controller.cableMaxCapacity.toFixed(0) + "A");

          $('#localtime').text(formatTime(data.controller.time));
          if (data.controller.switchOnTime < 0) {
            $('#switch_on_off_time_box').hide();
            $('#switch_off_time_button').hide();
            $('#switch_on_time_button').show();
          }
          else {
            $('#switch_on_off_time_box').show();
            $('#switch_off_time_button').show();
            $('#switch_on_time_button').hide();
            $('#switch_on_time').text(formatTime(data.controller.switchOnTime));
            $('#switch_off_time').text(formatTime(data.controller.switchOffTime));
          }
          /*$('#max_amps').prop("min", data.controller.minEVCurrent.toFixed(0));
          $('#max_amps').prop("max", data.controller.cableMaxCapacity == 0 ? data.controller.maxDeviceCurrent.toFixed(0) : data.controller.cableMaxCapacity.toFixed(0));
          $('#max_amps').val(data.controller.maxDeviceCurrent.toFixed(0));
          $('#max_amps').trigger("input");*/

          if (data.controller.isCharging) {
            let perc = (data.controller.chargeCurrent * 10) / Math.min(data.controller.maxDeviceCurrent, data.controller.maxMains);
            //$('#progress h3').text("Charging at " + (data.controller.chargeCurrent / 10).toFixed(1) + "A");
            //$('#progress h3').html("<i class=\"bi-lightning-charge\"></i> Charging at " + perc.toFixed(1) + "% max power");
            $('#progress h3').html("<i class=\"bi-battery-charging\"></i> Charging at " + perc.toFixed(1) + "% max power");
            $('#progress').show();
          }
          else {
            $('#progress').hide();
          }

          if (data.modbus.mainsMeterText == "Disabled" || data.controller.mode == 0) {
            $('#with_mainsmeter').hide();
          } else {
            $('#with_mainsmeter').show();
            $('#mainsmeter_description').text(data.modbus.mainsMeterText);
            $('#mainsmeter_phase_1').text((data.controller.Irms.L1 / 10).toFixed(1) + "A");
            $('#mainsmeter_phase_2').text((data.controller.Irms.L2 / 10).toFixed(1) + "A");
            $('#mainsmeter_phase_3').text((data.controller.Irms.L3 / 10).toFixed(1) + "A");

            if (data.modbus.lastCTResponseMillis > 0) {
              lastReceivedCTSeconds = data.modbus.lastCTResponseMillis;
              if (intervalHandler == null) {
                updateLastReceivedCT();
                $('[id=with_p1_api_data]').show();
                intervalHandler = setInterval(updateLastReceivedCT, 1000);
              }
            }
          }

          if (data.modbus.evMeterText == "Disabled" || data.controller.mode == 0) {
            $('#with_evmeter').hide();
          } else {
            $('#with_evmeter').show();
            $('#evmeter_description').text(data.modbus.evMeterText);
            $('#evmeter_power').text(data.modbus.powerMeasured.toFixed(1) + " kW");
            $('#evmeter_total_kwh').text(data.modbus.evMeterEnergy.toFixed(1) + " kWh");
            $('#evmeter_charged_kwh').text(data.modbus.energyCharged.toFixed(1) + " kWh");
          }

          <!-- MODE_SOLAR -->
          if (data.controller.mode == "2") {
            $('#solarmode_box').show();
          } else {
            $('#solarmode_box').hide();
          }
        } catch (error) {
          console.log(error);
        }

        setTimeout("loadData()", 5000);
      });
    }

    function activateMode(mode) {
      if (confirm("Do you want to change mode?")) {
        $.post("/settings?mode=" + mode);
      }
    }

    function changeLogLevel(level) {
      if (confirm("Do you want to change Log Level?")) {
        $.post("/settings?loglevel=" + level);
      }
    }

    function resetFlags(level) {
      if (confirm("Are you sure you want to reset error flags?")) {
        $.post("/settings?resetFlags");
      }
    }

    function modifyMainsMax() {
      let value = prompt("Enter new Mains MAX value (5 - 80)");
      if (value != null && parseInt(value) >= 5 && parseInt(value) <= 80) {
        $.post("/settings?maxmains=" + parseInt(value));
      }
    }

    function disableOperatingHours() {
      $.post("/settings?disableOperatingHours=y");
    }

    function solarBoostChanged() {
      let solarBoost = $("#solar_boost_check").prop("checked");
      if (solarBoost) {
        $('#solar_boost_check_label').text("Active");
        $('#solar_boost_check').prop("checked", true);
        $('#solar_boost_current_box').show();
      }
      else {
        $('#solar_boost_current_box').hide();
        $('#solar_boost_check_label').text("Disabled");
        $('#solar_boost_check').prop("checked", false);
      }

      if (prevSolarBoost != solarBoost) {
        if (prevSolarBoost != null) {
          $.post("/settings?solarBoost=" + (solarBoost ? '1' : '0'));
        }
        prevSolarBoost = solarBoost;
      }
    }

    function enableOperatingHours() {
      let switchOnTime = prompt("Enter switch on time (0 - 2359)");
      if (switchOnTime == null) {
        return;
      }
      let switchOffTime = prompt("Enter switch on time (0 - 2359)");
      if (switchOffTime == null) {
        return;
      }
      $.post("/settings?enableOperatingHours=y&switchon=" + parseInt(switchOnTime) + "&switchoff=" + parseInt(switchOffTime));
    }

    function reboot() {
      if (confirm("Do you want to reboot?")) {
        $.post("/reboot");
      }
    }

    function update() {
      window.open("/update", "_blank");
    }

    function rawData() {
      window.open("/settings", "_blank");
    }

    function webSerial() {
      window.open("/webserial", "_blank");
    }

    function forceCharge() {
      if (confirm("Do you want to force start charging?")) {
        window.open("/forcecharge", "_self");
      }
    }

    function forceDisconnect() {
      if (confirm("Do you want to force disconnect and stop charging?")) {
        window.open("/forcedisconnect", "_self");
      }
    }

    $(document).ready(loadData);
  </script>
</head>

<body data-bs-theme="dark" class="d-block h-100">
  <div id="wrapper">
    <div id="content-wrapper" class="d-flex flex-column">
      <div id="content">
        <div class="container-fluid">

          <div class="header" id="progress" style="display: none">
            <div class="inner-header">
              <h3 class="h5 fw-bold"></h3>
            </div>
            <!--Waves Container-->
            <div>
              <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
                <defs>
                  <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
                </defs>
                <g class="parallax">
                  <use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(255,255,255,0.7" />
                  <use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.5)" />
                  <use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.3)" />
                  <use xlink:href="#gentle-wave" x="48" y="7" fill="#fff" />
                </g>
              </svg>
            </div>
            <!--Waves end-->
          </div>
          <!--Header ends-->

          <div class="row">

            <div class="mb-4" id="evse_data">
              <div class="card shadow h-100 py-0 bg-body-tertiary">
                <div class="card-body">
                  <div class="row g-0 align-items-center">
                    <div class="col me-2">
                      <h3 class="fw-bold mb-1"><span id="hostname">EVSE</span> <span id="version">v</span></h3>
                      <div class="row g-0 align-items-center bg-light mb-2 ps-2" id="with_errors"
                        style="display: none;">
                        <div class="col-auto h5 mb-0 me-3 pb-2 pt-2 text-danger fw-bold">
                          <i class="bi bi-exclamation-octagon"></i> Error:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 pb-2 pt-2 me-3 text-danger" id="error"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto mb-0 h5 mb-0 me-3 pb-2" id="vehicle_connected">
                          <i class="bi bi-plug"></i>Vehicle connected
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto mb-0 h5 mb-0 me-3 pb-2">
                          <i class="bi bi-terminal"></i> Status:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 pb-2 me-3 text-muted" id="state"></div>
                        </div>
                      </div>


                      <div class="row g-0 align-items-center" id="chargedelayseconds_box" style="display: none">
                        <div class="col-auto mb-0 h5 mb-0 me-3 pb-2">
                          <i class="bi bi-stopwatch"></i> Charge delay:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 pb-2 me-3 text-muted" id="chargedelayseconds"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center" id="solarstoptimer_box" style="display: none">
                        <div class="col-auto mb-0 h5 mb-0 me-3 pb-2">
                          <i class="bi bi-stopwatch"></i> Solar stop timer:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 pb-2 me-3 text-muted" id="solarstoptimer"></div>
                        </div>
                      </div>


                      <div class="row g-0 align-items-center">
                        <div class="col-auto mb-0 h5 mb-0 me-3 pb-2">
                          <i class="bi bi-lightning-charge"></i> Current:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 pb-2 me-3 text-muted" id="charge_current"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center" id="solar_boost_current_box">
                        <div class="col-auto mb-0 h5 mb-0 me-3 pb-2">
                          <i class="bi bi-sunrise"></i> Solar boost:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 pb-2 me-3 text-muted" id="solar_boost_current"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto mb-0 h5 mb-0 me-3 pb-2">
                          <i class="bi bi-thermometer-half"></i> Temp:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 pb-2 me-3 text-muted" id="temp"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>

          <div class="row">

            <div class="col-xl-3 col-md-6 mb-4">
              <div class="card shadow h-100 py-0 bg-body-tertiary">
                <div class="card-body">
                  <div class="row g-0 align-items-center">
                    <div class="col">
                      <h6 class="fw-bold text-uppercase mb-1">Current Details</h6>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-lightning-charge"></i> Min:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="current_min"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-lightning-charge"></i> Max:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="current_max"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-code"></i> Override:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="override_current"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-plug"></i> Cable max:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="cable_max"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4" id="with_mainsmeter">
              <div class="card shadow h-100 py-0 bg-body-tertiary">
                <div class="card-body">
                  <div class="row g-0 align-items-center">
                    <div class="col">
                      <h6 class="fw-bold text-uppercase mb-1">Mains Meter</h6>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-speedometer2"></i> Type:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="mainsmeter_description">
                          </div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-lightning-charge"></i> L1:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="mainsmeter_phase_1"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-lightning-charge"></i> L2:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="mainsmeter_phase_2"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-lightning-charge"></i> L3:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="mainsmeter_phase_3"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center" id="with_p1_api_data">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-clock-history"></i> Last received:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="p1_data_received"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4" id="with_evmeter">
              <div class="card shadow h-100 py-0 bg-body-tertiary">
                <div class="card-body">
                  <div class="row g-0 align-items-center">
                    <div class="col">
                      <h6 class="fw-bold text-uppercase mb-1">EV Meter</h6>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-ev-front"></i> Type:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="evmeter_description">
                          </div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-lightning-charge"></i> Power:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="evmeter_power"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-lightning-charge"></i> Total kWh:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="evmeter_total_kwh"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-battery-half"></i> Charged kWh:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="evmeter_charged_kwh">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>


            <div class="col-xl-3 col-md-6 mb-4" id="solarmode_box" style="display: none">
              <div class="card shadow h-100 py-0 bg-body-tertiary">
                <div class="card-body">
                  <div class="row g-0 align-items-center">
                    <div class="col">
                      <h6 class="fw-bold text-uppercase mb-1">Solar mode</h6>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-sunrise"></i> Start current:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="solarstartcurrent"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-lightning-charge"></i> Import current:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="solarimportcurrent"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-stopwatch"></i> Solar stop timer:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="solarstoptimeminutes"></div>
                        </div>
                      </div>

                    </div>
                  </div>
                </div>
              </div>
            </div>


            <div class="col-xl-3 col-md-6 mb-4">
              <div class="card shadow h-100 py-0 bg-body-tertiary">
                <div class="card-body">
                  <div class="row g-0 align-items-center">
                    <div class="col">
                      <h6 class="fw-bold text-uppercase mb-1">SmartEVSE Device</h6>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-house-gear"></i> Mode:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="mode"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-gear"></i> Config:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="config"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-lightning-charge"></i> EVSE max:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="device_max"></div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-credit-card"></i> RFID:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="rfid">
                          </div>
                        </div>
                      </div>
                      <div class="row g-0 align-items-center" id="rfid_access_box" style="display: none">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-unlock"></i> Access:
                        </div>
                        <div class="col">
                          <div class="h5 mb-0 text-muted text-end" id="rfid_access">
                          </div>
                        </div>
                      </div>

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>


          <div class="row">
            <div class="mb-4">
              <div class="card shadow h-100 py-0 bg-body-tertiary">
                <div class="card-body">
                  <div class="row g-0 align-items-center">
                    <div class="col me-2">
                      <h4 class="fw-bold text-uppercase mb-1">Control</h4>
                      <div class="row g-0 align-items-center mb-3">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-house-gear"></i> Mode:
                        </div>
                      </div>
                      <div class="row g-0 align-items-center mb-3">
                        <div class="col">
                          <button id="mode_0" onclick="activateMode('0')" class="btn btn-outline-secondary me-2 mb-2"
                            type="button">NORMAL</button>
                          <button id="mode_1" onclick="activateMode('1')" class="btn btn-outline-secondary me-2 mb-2"
                            type="button">SMART</button>
                          <button id="mode_2" onclick="activateMode('2')" class="btn btn-outline-secondary me-2 mb-2"
                            type="button">SOLAR</button>
                        </div>
                      </div>

                      <div class="row g-0 align-items-center mb-3">
                        <div class="col-auto h5 mb-3 me-3">
                          <i class="bi bi-sunrise"></i> Solar boost:
                        </div>
                        <div class="col-auto h5 mb-4 form-check form-switch">
                          <input class="form-check-input" type="checkbox" role="switch" id="solar_boost_check"
                            onchange="solarBoostChanged()">
                          <label class="form-check-label" for="solar_boost_check"
                            id="solar_boost_check_label">--</label>
                        </div>
                      </div>
                      <!-- <div class="row g-0 align-items-center mb-3 form-check form-switch"> -->

                      <div class="row g-0 align-items-center mb-3">
                        <div class="col-auto h5 mb-0 me-3">
                          <i class="bi bi-alarm"></i> Operating hours:
                        </div>
                      </div>
                      <div class="row g-0 align-items-center mb-3">
                        <div class="row g-0 mb-2 align-items-center">
                          <div class="col-auto h5 mb-0 me-1">
                            Local time:
                          </div>
                          <div class="col-auto">
                            <div class="h5 mb-0 text-muted" id="localtime">--:--</div>
                          </div>
                        </div>
                        <div class="row g-0 mb-2 align-items-center" id="switch_on_off_time_box">
                          <div class="col-auto h5 mb-0 ms-3 me-1">
                            <i class="bi bi-lightbulb"></i> Switch on time:
                          </div>
                          <div class="col-auto">
                            <div class="h5 mb-0 text-muted" id="switch_on_time">--:--</div>
                          </div>
                          <div class="col-auto h5 mb-0 ms-3 me-1">
                            <i class="bi bi-lightbulb-off"></i> Switch off time:
                          </div>
                          <div class="col-auto">
                            <div class="h5 mb-0 text-muted" id="switch_off_time">--:--</div>
                          </div>
                        </div>
                        <div class="row g-0 align-items-center mb-3">
                          <div class="col">
                            <button id="switch_off_time_button" onclick="disableOperatingHours()"
                              class="btn btn-outline-secondary me-2 mb-2" type="button">Disable operating hours</button>
                            <button id="switch_on_time_button" onclick="enableOperatingHours()"
                              class="btn btn-outline-secondary me-2 mb-2" type="button">Enable
                              operating hours</button>
                          </div>
                        </div>
                      </div>

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="mb-4">
              <div class="card shadow h-100 py-0 bg-body-tertiary">
                <div class="card-body">
                  <div class="row g-0 align-items-center">
                    <div class="col me-2">
                      <h4 class="fw-bold text-uppercase mb-4">Advanced</h4>

                      <div class="row g-0 align-items-center mb-3">
                        <div class="col-auto h5 mb-0 mt-0 me-3">
                          <button class="btn btn-outline-secondary me-2 mb-2" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"
                            onclick="$(this).hide()">
                            Show advanced options
                          </button>
                        </div>
                      </div>


                      <div class="collapse" id="collapseExample">

                        <div class="row g-0 align-items-center mb-3">
                          <div class="col-auto h5 mb-0 me-3">
                            <i class="bi bi-bug"></i> Log level:
                          </div>
                        </div>
                        <div class="row g-0 align-items-center mb-3">
                          <div class="col">
                            <button id="loglevel_0" onclick="changeLogLevel('0')"
                              class="btn btn-outline-secondary me-2 mb-2" type="button">DEBUG</button>
                            <button id="loglevel_1" onclick="changeLogLevel('1')"
                              class="btn btn-outline-secondary me-2 mb-2" type="button">INFO</button>
                            <button id="loglevel_2" onclick="changeLogLevel('2')"
                              class="btn btn-outline-secondary me-2 mb-2" type="button">WARN</button>
                            <button id="loglevel_3" onclick="changeLogLevel('3')"
                              class="btn btn-outline-secondary me-2 mb-2" type="button">ERROR</button>
                          </div>
                        </div>

                        <div class="row g-0 align-items-center mb-3">
                          <div class="col-auto h5 mb-0 me-3">
                            <i class="bi bi-braces"></i> Actions:
                          </div>
                        </div>
                        <div class="row g-0 align-items-center mb-3">
                          <div class="col">
                            <button onclick="rawData()" class="btn btn-outline-secondary me-2 mb-2" type="button">Raw
                              Data</button>
                            <button onclick="webSerial()" class="btn btn-outline-secondary me-2 mb-2"
                              type="button">Console</button>
                            <button onclick="resetFlags()" class="btn btn-outline-secondary me-2 mb-2"
                              type="button">Clear
                              errors</button>
                            <button onclick="modifyMainsMax()" class="btn btn-outline-secondary me-2 mb-2"
                              type="button">Modify Mains Max
                            </button>
                            <button onclick="update()" class="btn btn-outline-secondary me-2 mb-2" type="button">Update
                              firmware</button>
                            <button onclick="forceCharge()" class="btn btn-outline-secondary me-2 mb-2"
                              type="button">Force
                              Charge</button>
                            <button onclick="forceDisconnect()" class="btn btn-outline-secondary me-2 mb-2"
                              type="button">Force Disconnect</button>
                            <button onclick="reboot()" class="btn btn-outline-secondary me-2 mb-2"
                              type="button">Reboot</button>
                          </div>
                        </div>

                      </div>

                    </div>
                  </div>
                </div>


              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>

</html>